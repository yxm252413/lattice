<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>会员列表-WeAdmin Frame型后台管理系统-WeAdmin 1.0</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" href="../../layui/css/layui.css" />

		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
	      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
	      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->
	</head>

	<body>

		<div class="weadmin-body">
			

			<table class="layui-hide" id="test" lay-filter="test"></table>

			<script type="text/html" id="toolbarDemo">
				<div class="layui-btn-container" style="display: flex;flex-wrap: nowrap;">
					<button class="layui-btn layui-btn-sm" lay-event="delete">批量删除</button>
					<button class="layui-btn layui-btn-sm" lay-event="instock">批量下架</button>
					<button class="layui-btn layui-btn-sm" lay-event="reshelf">批量上架</button>
					
				</div>
			</script>
			<script type="text/html" id="change">
				{{# if(d.status == '1'){ }}
				<div class="layui-bg-green">已上架</div>
				{{# } else if(d.status == '2'){ }}
				<div class="layui-bg-orange">已下架</div>
				{{# } else if(d.status == '3'){ }}
				<div class="layui-bg-red">已删除</div>
				{{# } else{ }}
				<a class="layui-btn layui-btn-xs">异常</a>
				{{# } }}
			</script>

			<script type="text/html" id="barDemo">
				<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
				{{# if(d.status == '1'){ }}
				<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="instock">下架</a>
				{{# } else{ }}
				<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="reshelf">上架</a>
				{{# } }}

			</script>

		</div>
		<!--<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>-->
		<script src="../../layui/layui.js" charset="utf-8"></script>
		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<script>
			function getIds(data) {
				var ids = [];
				for(var i = 0; i < data.length; i++) {
					ids.push(data[i].orderid)
				}
				return ids;
			}
			layui.use('table', function() {
				var table = layui.table;

				table.render({
					elem: '#test',
					url: 'http://127.0.0.1:8444/order/order/list',
					toolbar: '#toolbarDemo',
					methpd:"get",
					title: '用户数据表',
					cols: [
						[{
							type: 'checkbox',
							fixed: 'left'
						}, {
							field: 'orderid',
							title: '订单id',
							fixed: 'left',
							align: 'center',
							sort: true
						},{
							field: 'payment',
							title: '支付金额',
							align: 'center',
							fixed: 'left',
							sort: true
						},{
							field: 'paymentType',
							title: '支付类型',
							align: 'center',
							fixed: 'left',
							sort: true
						},{
							field: 'postFree',
							title: '邮费',
							align: 'center',
							fixed: 'left',
							sort: true
						},{
							field: 'shippingname',
							title: '物流名称',
							align: 'center',
							fixed: 'left',
							sort: true
						},{
							field: 'shippingcode',
							title: '物流单号',
							align: 'center',
							fixed: 'left',
							sort: true
						},{
							field: 'userid',
							title: '用户id',
							align: 'center',
							fixed: 'left',
							sort: true
						},{
							field: 'buyermessage',
							title: '买家留言',
							align: 'center',
							fixed: 'left',
							sort: true
						},{
							fixed: 'right',
							title: '操作',
							toolbar: '#barDemo'

						}]
					],
					page: true,
					response: {
						    statusName: 'code' //数据状态的字段名称，默认：code
						    ,statusCode: 200 //成功的状态码，默认：0
						    ,msgName: 'msg' //状态信息的字段名称，默认：msg
						    ,countName: 'count' //数据总数的字段名称，默认：count
						    ,dataName: 'data' //数据列表的字段名称，默认：data
							}

					});

				//头工具栏事件
				table.on('toolbar(test)', function(obj) {
					var checkStatus = table.checkStatus(obj.config.id);
					var data = checkStatus.data;
					console.log(data)
					var ids = getIds(data);
					console.log(ids)
					switch(obj.event) {
						case 'instock':
							$.ajax({
								type: "put",
								url: "http://127.0.0.1:8444/order/order/updateStatus/instock?ids=" + ids,
								async: true,
								success: function(res) {
									if(res) {
										layer.open({
											type: 1,
											title: "下架成功",
											time: 500
										})
										$(".layui-laypage-btn")[0].click();
									} else {
										layer.open({
											type: 1,
											title: "下架失败",
											time: 500
										})
									}

								}

							});
						case 'reshelf':
							$.ajax({
								type: "put",
								url: "http://127.0.0.1:8444/order/order/updateStatus/reshelf?ids=" + ids,
								async: true,
								success: function(res) {
									if(res) {
										layer.open({
											type: 1,
											title: "上架成功",
											time: 500
										})
										$(".layui-laypage-btn")[0].click();
									} else {
										layer.open({
											type: 1,
											title: "上架失败",
											time: 500
										})
									}

								}

							});
							break;
					};
				});

				//监听行工具事件
				table.on('tool(test)', function(obj) {
					var data = obj.data;
					if(obj.event === 'instock') {
						$.ajax({
							type: "put",
							url: "http://127.0.0.1:8444/order/order/updateStatus/instock?ids=" + data.orderid,
							async: true,
							success: function(res) {
								if(res) {
									layer.open({
										type: 1,
										title: "下架成功",
										time: 500
									})
									$(".layui-laypage-btn")[0].click();
								} else {
									layer.open({
										type: 1,
										title: "下架失败",
										time: 500
									})
								}

							}

						});
					} else if(obj.event === 'edit') {
						layer.open({
							type: 2,
							area: ['700px', '400px'],
							content: 'add.html?id=' + data.orderid //这里content是一个普通的String
						});
					} else if(obj.event == 'reshelf') {
						$.ajax({
							type: "put",
							url: "http://127.0.0.1:8444/order/order/updateStatus/reshelf?ids=" + data.orderid,
							async: true,
							success: function(res) {
								if(res) {
									layer.open({
										type: 1,
										title: "上架成功",
										time: 500
									})
									$(".layui-laypage-btn")[0].click();
								} else {
									layer.open({
										type: 1,
										title: "上架失败",
										time: 500
									})
								}

							}

						});
					}
				});
			});
		</script>
	</body>

</html>